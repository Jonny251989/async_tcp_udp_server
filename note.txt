
chmod +x scripts/test_simple.sh


#kill process
sudo pkill -f async_tcp_udp_server
sudo kill -9 $(sudo lsof -t -i:8080) 2>/dev/null || true

# Проверим что порт свободен
sudo lsof -i :8080 || echo "Port 8080 is free"
Port 8080 is free

# Пересобери
make clean
make

# Переустанови
sudo make uninstall
sudo make install
sudo make systemd-install

# Очистим журнал systemd для этого сервиса
sudo journalctl --vacuum-time=1s --unit=async-tcp-udp-server

# Запустим сервер заново
sudo systemctl start async-tcp-udp-server

# Проверим статус
sudo systemctl status async-tcp-udp-server

# Протестируем команды
echo "/time" | /usr/local/bin/async_client tcp 127.0.0.1 8080
echo "/stats" | /usr/local/bin/async_client tcp 127.0.0.1 8080

# Остановим сервер
sudo systemctl stop async-tcp-udp-server

# Проверим новые логи
sudo journalctl -u async-tcp-udp-server --no-pager




# Перезагрузи systemd конфигурацию
sudo systemctl daemon-reload

# Запусти сервис
sudo systemctl start async-tcp-udp-server

# Проверь статус
sudo systemctl status async-tcp-udp-server

# Протестируй что сервер работает
echo "/time" | /usr/local/bin/async_client tcp 127.0.0.1 8080

# Останови сервис и следи за логами
sudo systemctl stop async-tcp-udp-server

# Проверь статус остановки
sudo systemctl status async-tcp-udp-server

# Посмотри полные логи
sudo journalctl -u async-tcp-udp-server --no-pager


#перезапускать
# Запустим сервер
sudo systemctl start async-tcp-udp-server

# Проверим статус
sudo systemctl status async-tcp-udp-server

# Протестируем команды
echo "/time" | /usr/local/bin/async_client tcp 127.0.0.1 8080

# Остановим сервер и посмотрим на логи
sudo systemctl stop async-tcp-udp-server

# Проверим статус остановки
sudo systemctl status async-tcp-udp-server